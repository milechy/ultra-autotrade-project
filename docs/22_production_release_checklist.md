# 22_production_release_checklist.md
Ultra AutoTrade – Production リリース前チェックリスト

本ドキュメントは、Ultra AutoTrade の機能を  
**production 本番環境にデプロイする前・直後に確認すべき項目** を一覧化したものである。

このチェックリストを満たすことで、  
「本番リリースを実行してよい状態」を定義する。

---

## 1. 前提条件チェック

- [ ] `20_staging_release_checklist.md` の全項目が完了している
- [ ] `14_test_strategy.md` に沿ったテストが実施され、問題がないことを確認した
- [ ] リリース対象のコードが staging で一定期間安定稼働している
- [ ] ロールバック手順（`15_rollback_procedures.md`）をリリース担当者が事前に確認した
- [ ] 関係者（プロジェクトオーナー / インフラ担当など）にリリース時間帯を共有済み

---

## 2. 環境設定の確認（.env.production）

- [ ] 本番サーバに `.env.production` が存在する
- [ ] `.env.production` のパーミッションが `600` になっている
- [ ] `APP_ENV=production` に設定されている
- [ ] `docs/21_production_environment_config.md` に記載されている必須項目がすべて埋まっている
- [ ] Notion / OctoBot / Aave / 通知系などのキー・URL が **すべて本番用** である
- [ ] staging 用のキー・ウォレット・トークンが混入していないことをダブルチェックした

---

## 3. リリース前の技術チェック

- [ ] リリース対象ブランチ / タグが正しい（例：`main` の特定コミット）
- [ ] 本番サーバ上のリポジトリがクリーンであり、不要なローカル変更がない
- [ ] `scripts/deploy_production_backend.sh` の内容が最新である
- [ ] 必要なツール（`git`, `docker`, `docker compose`, `systemd` など）がインストール済み

---

## 4. リリース作業中のチェック

- [ ] リリース作業開始前に、作業者・開始時刻を記録した
- [ ] `scripts/deploy_production_backend.sh` を実行し、エラーなく完了した
- [ ] デプロイ中に出力されたログを保存した（少なくとも直近の出力をコピー）
- [ ] docker または systemd のステータスを確認し、backend が `running` になっている

---

## 5. リリース直後のスモークテスト

- [ ] backend API に対して、read-only なエンドポイントで疎通確認を行った
- [ ] Notion から backend への軽量なフロー（安全なニュース / テスト用レコード等）が成功する
- [ ] OctoBot / Aave との連携について、致命的なエラーが発生していない
- [ ] ログに予期しない例外・スタックトレースが連続して出ていない
- [ ] LINE / Slack / Webhook など、本番通知チャネルへのテスト通知が成功した

---

## 6. リリース後モニタリング

- [ ] リリース直後の 1〜2 時間、ログと監視アラートを継続的に確認した
- [ ] 不審なトレード・シグナル・API アクセスがないことを確認した
- [ ] Aave ポジションの状態（残高 / Health Factor 等）に異常がない
- [ ] リリース直後〜数時間の間、`docs/08_automation_rules.md` で定義された
      主要メトリクス（レスポンスタイム / エラー率 / ヘルスファクター / 緊急停止フラグなど）を確認した
- [ ] 緊急停止フラグが ON になった場合、メトリクス `emergency_stop_flag` および
      EMERGENCY レベルの MonitoringEvent が期待どおりに記録されていることを確認した
- [ ] `scripts/monitor.sh daily` / `scripts/monitor.sh weekly` が予定どおり動作し、
      monitor 系ログにエラーが出ていないことを確認した

問題が発生した場合：

- [ ] `15_rollback_procedures.md` に従い、ロールバックの是非と手順を検討した
- [ ] 必要に応じてロールバックを実行し、その結果を確認した

---

## 7. 記録・振り返り

- [ ] リリース日・担当者・対象コミット（ハッシュ）を記録した
- [ ] 主要な実行ログ（デプロイログ / 監視アラート / スモークテスト結果）を保存した
- [ ] 問題点や改善点があれば、Issue / Notion ページなどにメモを残した

本チェックリストは、Phase8 で整備した本番インフラ・セキュリティ設計  
およびテスト戦略に基づき、随時更新していく。
